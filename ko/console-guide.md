## Network > VPC > 콘솔 사용 가이드

본 문서에서는 콘솔에서 VPC를 다룰 때 필요한 내용을 기술합니다.

## 동영상 가이드
<iframe width="560" height="315" src="https://www.youtube.com/embed/faX5L2XA_78" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

<iframe width="560" height="315" src="https://www.youtube.com/embed/qLjzBebDaqE" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

## VPC

VPC는 여러 서브넷을 가질 수 있기 때문에 서브넷을 분할하여 사용하는 경우 충분히 큰 네트워크를 설정해야 합니다. VPC 네트워크를 기술하는 방법은 [CIDR Notation](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing)을 사용하여 기술 할 수 있습니다. 모든 VPC는 [프라이빗 네트워크](https://en.wikipedia.org/wiki/Private_network)를 구성할 수 있는 아래 3개의 주소 영역에 있어야 하며 링크 로컬 주소는 사용할 수 없습니다. 또한 적어도 24bit-256개 보다 큰 네트워크 영역을 지정해야 합니다.

### 프라이빗 네트워크

RFC1918 | IP 주소 영역 | 사용 가능한 주소 개수
-------- | ---------- | -----------------
24bit block | 10.0.0.0/8 | 16,777,216
20bit block | 172.16.0.0/12 | 1,047,576
16bit block | 192.168.0.0/16 | 65,536

### 링크 로컬 주소

169.254.0.0/16에 포함되는 65,536개의 IP 주소는 사용할 수 없습니다.

### 예제

예시 | 사용 가능 여부
-------- | ---------- 
10.0.0.0/8 | 사용 가능합니다.
10.0.0.0/16 | 사용 가능합니다.
10.0.0.0/24 | 사용 가능합니다.
10.0.0.0/28 | 사용이 불가합니다. 범위가 너무 작습니다.
172.16.0.0/16 | 사용 가능합니다.
172.16.0.0/8 | 사용이 불가합니다. 사용 가능 범위를 벗어났습니다.
192.168.0.0/16 | 사용 가능합니다. 기본 사용 범위로 지정됩니다.
192.168.0.0/24 | 사용 가능합니다.
192.253.0.0/24 | 사용이 불가합니다. 사용 가능 범위를 벗어났습니다. 

<br>


최초 Compute 와 Network 상품을 사용하면 아래와 같은 항목을 자동으로 구성합니다.

항목 | 이름 | 요약
-------- | ---------- | --------------
VPC | Default Network | 192.168.0.0/16 범위의 VPC 1개가 만들어집니다.
서브넷 | Default Network | 192.168.0.0/24 범위의 서브넷 1개가 만들어집니다.
라우팅 테이블 | vpc-[id] | VPC 아이디의 일부를 이름으로 갖는 라우팅 테이블 1개가 만들어집니다.
인터넷 게이트웨이 | ig-[id] | 라우팅 테이블 아이디의 일부를 이름으로 갖는 인터넷 게이이트웨이 1개가 만들어집니다.
보안 그룹 | default | default라는 이름을 갖는 보안 그룹 1개가 만들어집니다.

초기 구성이 아니라 VPC를 추가하는 경우는 아래 항목을 구성합니다.

항목 | 이름 | 요약
-------- | ---------- | --------------
VPC | 지정한 이름 | 지정한 범위의 VPC 1개가 만들어집니다.
서브넷 | - | 생성되지 않음
라우팅 테이블 | vpc-[id] | VPC 아이디의 일부를 이름으로 갖는 라우팅 테이블 1개가 만들어집니다.
인터넷 게이트웨이 | - | 생성되지 않기 때문에 별도 생성후 연결해야 합니다.
보안 그룹 | - | 추가로 생성되지 않습니다.

VPC와 각 항목의 Quota는 아래와 같습니다.

항목 | 최대값
-------- | ---------- 
VPC | 3
서브넷 | VPC당 10 
인터넷 게이트웨이 | 3 
플로팅 IP | 제한 없음
라우팅 테이블 | VPC당 10 
라우트 | 라우팅 테이블당 10
피어링 | 제한 없음
NAT 게이트웨이 | 3



> [참고]
VPC를 삭제하기 위해서 서브넷을 모두 삭제 할 수 있는 상태에서만 가능하며, 그런 경우라면 서브넷, 라우팅 테이블, 인터넷 게이트웨이와 함께 삭제합니다.

* VPC는 다른 VPC와 완전히 격리되어 트래픽으로부터 안전합니다.

* VPC는 프라이빗 네트워크이기 때문에 인터넷에서 직접 액세스는 불가능합니다.

* VPC 내 모든 요소는 VLAN을 사용할 수 없습니다.

* Region을 넘어서는 트래픽에 대해서는 로컬 통신을 제공하지 않습니다.

* 인터넷 게이트웨이 없이는 VPC 내 모든 인스턴스가 인터넷에 연결되지 않습니다.

* 과도하게 전송되는 "Broadcast, Multicast, Unknown Unicast"는 예고없이 차단될 수 있습니다.


## 서브넷

VPC는 서브넷으로 나누어 작은 네트워크 여러개를 구성할 수 있습니다. 다만 서브넷의 경우에는 VPC 주소 범위에 포함되어야 하며 주소 길이가 같거나 작아야 합니다. 예를 들면 192.168.0.0/16의 경우 192.168.0.0 ~ 192.168.255.255까지 총 65536개의 IP 주소를 사용할 수 있습니다. 또한 가장 작은 서브넷은 28bit이며 이것 보다 작게 구성할 수는 없습니다. 서브넷도 VPC와 같이 CIDR 표기법을 사용합니다.

서브넷이 생성되면 게이트웨이 IP 주소는 자동으로 지정되며 이를 변경 할 수 없습니다. 또한 VPC에 포함된 라우팅 테이블에 자동으로 등록됩니다. 

> [참고]
서브넷 삭제는 인스턴스나 로드 밸런서 등이 포함되어 있지 않은 비어있는 서브넷의 경우에만 가능합니다. 또한 서브넷이 연결되어 있는 라우팅테이블에 해당 서브넷으로 향하는 라우트가 없어야 합니다.

* 인스턴스가 생성되면 지정한 서브넷으로부터 한개의 IP 주소를 할당받습니다. (Fixed IP라고 합니다.)

* 인스턴스가 부팅되면 DHCP를 통하여 IP 주소가 인스턴스에 적용됩니다.

* 서브넷의 주소 범위를 수정할 수 없습니다.

* 같은 VPC 내에서 서로 다른 서브넷의 범위가 중복되거나 겹치게 생성할 수 없습니다.

* 다른 VPC에서는 서브넷의 범위가 중복되거나 겹칠 수 있습니다.

* 인스턴스에 할당된 MAC 주소가 아닌 경우 네트워크 상에서 차단될 수 있습니다. 따라서 VPN 서비스를 인스턴스에서 구동하는 경우 동작하지 않을 수 있습니다.

* 인스턴스에 여러개의 서브넷을 연결하는 경우 인스턴스 내 OS에서 적절한 라우팅 설정이 필요합니다.

* 동일한 VPC 내 두 개의 서브넷은 완전히 격리된 것이 아닙니다. 보안 그룹을 사용하여 인스턴스를 보호하세요.

* 서브넷은 서로 다른 가용성 영역에 걸쳐서 로컬 통신을 지원합니다. 로컬 통신은 과금하지 않습니다.


## 인터넷 게이트웨이

인터넷 게이트웨이는 라우팅 테이블과 연결할 수 있습니다. 프라이빗 네트워크로 만들어진 VPC는 외부 연결이 불가능한데, 인터넷 게이트웨이를 이용하여 인터넷을 액세스 할 수 있습니다. 인터넷으로 연결하기 위해서 각 인스턴스는 "기본 게이트웨이"를 서브넷의 게이트웨이 주소로 설정해야 하는데 TOAST에서는 이를 자동으로 처리합니다. 인터넷 게이트웨이를 생성하는 경우 외부 네트워크를 선택해야 하는데 TOAST에서 현재 "public_network" 1개만 운영하고 있습니다.

* 인터넷 게이트웨이 주소는 인스턴스가 생성되거나 VPC가 인터넷 연결이 요구되는 상태에 자동 할당 되며 임의로 변경할 수 없습니다.

* 인터넷 게이트웨이 주소로 인스턴스에 액세스 할 수 없습니다.

* 인터넷 게이트웨이 조소로 유입되는 트래픽은 전부 차단됩니다.

* 인터넷에 연결된 인스턴스가 인터넷 방향으로 트래픽을 유발하면 사용한 만큼 과금합니다.

* 인스턴스간 로컬 통신에 대해서는 과금하지 않습니다.

### 서버 점검을 위한 인터넷게이트웨이 재시작 가이드

TOAST는 주기적으로 인터넷게이트웨이 서버의 소프트웨어를 업데이트하여 기본 인프라 서비스의 보안과 안정성을 향상시키고 있습니다.
인터넷게이트웨이 서버 점검을 위해 점검 대상 서버에서 구동 중인 인터넷게이트웨이는 재시작을 통해 점검이 완료된 인터넷게이트웨이 서버로 이동해야 합니다.

재시작이 필요한 인터넷게이트웨이는 이름 옆에 **! 재시작** 버튼이 표시되며, 이 버튼을 사용하여 재시작할 수 있습니다.

점검 대상으로 지정된 인터넷게이트웨이가 있는 프로젝트로 이동하여 다음 절차로 재시작을 수행합니다.

1. 점검 대상 인터넷게이트웨이를 확인합니다.
   이름 옆에 **! 재시작** 버튼이 있는 인터넷게이트웨이가 점검 대상 인터넷게이트웨이입니다.
   ![인터넷게이트웨이 점검이미지 001](http://static.toastoven.net/prod_vpc/ConsoleGuide/ig_planned_migration_guide-ko-001.png)
   **! 재시작** 버튼 위에 마우스 커서를 올리면 자세한 점검 일정을 확인할 수 있습니다. 
   ![인터넷게이트웨이 점검이미지 002](http://static.toastoven.net/prod_vpc/ConsoleGuide/ig_planned_migration_guide-ko-002.png)
2. 점검 대상 인터넷게이트웨이를 선택하고 이름 옆에 있는 **! 재시작** 버튼을 클릭합니다.
   재시작이 완료되기 전까지, 점검 대상 인터넷게이트웨이를 사용하는 인스턴스의 인터넷 연결이 차단되므로 서비스에 영향을 주지 않는 시간에 수행하시기 바랍니다. 
   단, 플로팅 IP를 연결한 인스턴스는 인터넷게이트웨이 재시작에 영향을 받지 않습니다.
3. 인터넷게이트웨이 재시작 여부를 묻는 창이 나타나면 **확인** 버튼을 클릭합니다.
   ![인터넷게이트웨이 점검이미지 003](http://static.toastoven.net/prod_vpc/ConsoleGuide/ig_planned_migration_guide-ko-003.png)
4. 상태 표시등이 초록색으로 변하고, **! 재시작** 버튼이 사라질 때까지 대기합니다.
   인터넷게이트웨이 상태 표시등이 변하지 않거나 **! 재시작** 버튼이 사라지지 않는다면 '새로 고침'을 해보시기 바랍니다.
   ![인터넷게이트웨이 점검이미지 004](http://static.toastoven.net/prod_vpc/ConsoleGuide/ig_planned_migration_guide-ko-004.png)

인터넷 게이트웨이가 재시작되는 동안에는 해당 인터넷 게이트웨이를 조작할 수 없습니다.
인터넷 게이트웨이가 정상적으로 재시작되지 않으면 자동으로 관리자에게 보고되며, NHN Cloud에서 별도로 연락을 드립니다.



## NAT 게이트웨이
한국(평촌) 리전에서만 제공하는 기능입니다.
NAT 게이트웨이는 라우팅 테이블의 라우트 설정에서 게이트웨이로 지정할 수 있습니다. NAT 게이트웨이를 라우팅 테이블의 게이트웨이로 설정하면 NAT 게이트웨이의 플로팅 IP를 소스 IP로 변환하여 인터넷을 액세스할 수 있습니다.

| 항목      | 설명                                                         |
| --------|------------------------------------------------------------ |
| 이름      | NAT 게이트웨이 이름을 지정할 수 있습니다. |
| VPC      | NAT 게이트웨이를 생성할 VPC를 지정합니다. |
| 서브넷     | 선택한 VPC의 서브넷 중에 인터넷 게이트웨이가 연결되어 있는 라우팅 테이블에 연결된 서브넷을 지정합니다. 조건에 만족하지 않는 서브넷으로는 NAT 게이트웨이를 생성할 수 없습니다.  |
| 플로팅 IP  | NAT 게이트웨이에 할당할 플로팅 IP를 지정합니다. 인터넷에 액세스할 때 이 IP가 소스 IP로 변환됩니다. |
| 설명      | NAT 게이트웨이에 대한 설명을 추가할 수 있습니다.  |

* NAT 게이트웨이의 VPC, 서브넷, 플로팅 IP는 변경할 수 없습니다.

* NAT 게이트웨이에 설정된 플로팅 IP는 연결을 해제할 수 없습니다. NAT 게이트웨이가 삭제되면 자동으로 연결이 해제됩니다.

* NAT 게이트웨이 주소로 인스턴스에 액세스할 수 없습니다.

* NAT 게이트웨이 주소로 유입되는 트랙픽은 전부 차단됩니다.

* 하나의 NAT 게이트웨이는 같은 VPC 내의 여러 라우팅 테이블에서 게이트웨이로 지정할 수 있습니다.

* NAT 게이트웨이 설정 시 지정한 서브넷과 다른 서브넷에 연결된 라우팅 테이블도 NAT 게이트웨이를 게이트웨이로 지정할 수 있습니다.

* 네트워크 ACL이 적용됩니다.

* 라우트 설정에서 IP Prefix 0 (/0)이 아닌 라우트 대상 CIDR에 대해 'NAT 게이트웨이'를 게이트웨이로 설정하면, 인스턴스에 플로팅 IP가 설정되어 있더라도 'NAT 게이트웨이'로 통신됩니다.



## 라우팅 테이블

라우팅 테이블은 VPC와 함께 생성되며 VPC가 삭제되는 경우 함께 삭제됩니다. 라우팅 테이블은 VPC에 복수개가 생성될 수 있으며 기본 라우팅 테이블이 아니라면 명시적으로 삭제할 수 있습니다. 서브넷은 적어도 하나의 라우팅 테이블에 연결되어야 하며, 복수개의 라우팅 테이블이 하나의 인터넷 게이트웨이를 공유할 수 없습니다.

라우팅 테이블 목록을 지정하는 경우 상세 화면에 요약된 정보가 표기되며, "라우트" 탭을 이용하여 경로를 추가할 수 있습니다.

> [참고]
경로를 추가하게 되는 경우 VPC내에 도달 가능한 영역을 지정해야만 추가할 수 있습니다. 그 외에는 실패 메시지가 발생합니다.

* 라우팅 테이블에 포함되는 서브넷의 게이트웨이는 자동으로 추가됩니다.

* "기본 라우팅 테이블"은 삭제할 수 없습니다. VPC 삭제 시 함께 삭제됩니다.

* 서브넷의 게이트웨이와 인터넷 게이트웨이는 라우트 목록에서 삭제할 수 없습니다.

* 라우팅 테이블과 인터넷 게이트웨이 연결을 끊게 되면 인터넷 연결이 끊어집니다.



## 피어링

피어링은 서로 다른 두 개의 VPC를 연결하는 기능입니다. 보통의 경우 VPC는 네트워크 영역이 다르기 때문에 서로 통신이 불가능하며, 플로팅 IP를 이용하여 연결할 수 있으나 이는 네트워크 사용량에 따라 추가 과금됩니다. 따라서 두 개의 VPC를 연결하는 기능을 제공하는데 이를 피어링이라 합니다.

> [참고] 피어링은 서로 다른 두 VPC를 연결합니다. 다른 VPC를 건너서 또 다른 VPC로 연결은 지원하지 않습니다. A <-> B <-> C 연결에서 A와 C는 연결되지 않습니다.

* 두 VPC의 IP 주소 영역은 겹치면 사용할 수 없습니다.<br>
IP 주소 영역이 한쪽이 다른 한쪽과 포함관계가 되어서는 안되며, 이런 경우 피어링 생성이 실패합니다.
* IP 주소 영역의 크기는 무관하며 "기본 라우팅 테이블"에 연결되지 않은 서브넷으로는 통신이 불가능 합니다.
  * 한국(평촌) 리전은 피어링을 생성한 후, 피어링한 양쪽 VPC의 라우팅 테이블에 별도의 라우트를 설정해야 통신이 가능합니다.
    * 라우트의 "대상 CIDR"에 상대 VPC의 IP 주소 영역을 입력하고, "게이트웨이" 목록에서 피어링의 이름을 갖는 "PEERING" 항목을 선택하여 라우트를 추가합니다.
    * 라우트를 추가한 라우팅 테이블에 연결된 서브넷으로만 통신이 가능합니다.
* 피어링은 연결과 동시에 과금됩니다.
* 피어링은 쿼터 제한이 없으나 서브넷 쿼터 1개를 사용합니다.
  * 한국(평촌) 리전은 서브넷 쿼터를 사용하지 않고 피어링된 두 VPC 내에서 IP 1개씩을 사용합니다.



## 코로케이션 게이트웨이

코로케이션 게이트웨이는 TOAST에서 하이브리드로 제공하는 고객의 네트워크를 연결하기 위한 기능이며 한국(평촌) 리전에만 제공됩니다. TOAST에서 하이브리드 서비스를 사용하는 경우에 한정하여 TOAST Zone이 제공되고, 코로케이션 게이트웨이를 이용하여 구성한 VPC에 TOAST Zone을 직접 연결할 수 있습니다.

* 한 개의 VPC는 한 개의 TOAST Zone과 1:1로 연결됩니다.
* 연결과 동시에 과금됩니다.



